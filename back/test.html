<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="./css/login.css">
</head>
<body>
    <div>
        <p>
            <input type='email' name='email' id="email" placeholder='请输入邮箱' required/>
            <button type="button" onclick="getCode()">获取验证码</button>
        </p>
        <p>
            <input type='text' name='confirmcode' id="confirmcode" placeholder='验证码' />
        </p>
        <p>
            <input type='password' name='pass' id="pass" placeholder='密码'/>
        </p>
        <p>
            <input type='password' name='confirmpass' id="confirmpass" placeholder='确认密码'/>
        </p>
        <button type="submit" onclick="resign()">
            立即注册
        </button>
        <li>注册即同意《用户协议》</li>
    </div>
    <br/>
    <br/>
    <br/>
    <div>
        <p>
            <input type='email' name='email' id="loemail" placeholder='请输入邮箱' required/>
        </p>
        <p>
            <input type='password' name='pass' id="lopass" placeholder='密码'/>
        </p>
        <button type="submit" onclick="login()">
            登录
        </button>
    </div>
    <br/>
    <br/>
    <br/>
    <div>
        <p>
            <label for="fileupload" class="updata_file">点击这里上传图片</label>
            <input 
            id='fileupload'
            onChange={this.upfiles}                           
            type='file'  
            accept="image/*" 
            capture="camera" 
            name='uimage'
            style="display: none"
            />
        </p>
        <p>
            <img src="" id="imageview" >
        </p>
        <button type="submit" onclick="upPicture()">
            保存记录
        </button>
    </div>
</body>
<script src="http://code.jquery.com/jquery-3.1.1.min.js"></script>
<script>
    var email = document.getElementById('email');
    var confirmcode = document.getElementById('confirmcode');
    var pass = document.getElementById('pass');
    var loemail = document.getElementById('loemail');
    var lopass = document.getElementById('lopass');
    // 获取验证码
    function getCode(){
        // console.log('mail',mail.value);
        // console.log('mailtype',typeof(mail.value));
        var url = 'http://127.0.0.1:3001/resign/email';
        fetch(url,{
            method:'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body:`email=${email.value}`
        }).then(res=>res.json())
        .then(res=>{
            console.log('res',res)
        })
    }
    // 注册
    function resign(){
        // console.log('mail',email.value);
        // console.log('mailtype',typeof(mail.value));
        var url = 'http://127.0.0.1:3001/resign/message';
        fetch(url,{
            method:'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },  
            body:`email=${email.value}&confirmcode=${confirmcode.value}&pass=${pass.value}`
        }).then(res=>res.json())
        .then(res=>{
            console.log('res',res)
        })
    }

    // 登录
    function login(){
        // console.log('mail',email.value);
        // console.log('mailtype',typeof(mail.value));
        var url = 'http://127.0.0.1:3001/login';
        fetch(url,{
            method:'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },  
            body:`email=${loemail.value}&pass=${lopass.value}`
        }).then(res=>res.json())
        .then(res=>{
            console.log('res',res)
        })
    }

    // 图片上传
    function upPicture(){
        var file=document.getElementById('fileupload').files[0];
        var url = 'http://127.0.0.1:3001/img';
		var reader = new FileReader();
        var img='';
        reader.readAsDataURL(file);
        reader.onloadend = function (e) {   
            $("#imageview").attr("src",e.target.result);
            var img=e.target.result;
            var data=img.split(",")[1];
            // console.log(img.split(",")[1])
            // console.log(typeof(e.target.result))
            fetch(url,{
                method:'POST',
                headers: {
                    // 'Content-Type': 'application/x-www-form-urlencoded'
                    'Accept': 'application/json',
                    'Content-Type':'application/json;charset=UTF-8'
                },  
                // body:`data=${e.target.result}`
                body:JSON.stringify({data:data})
            }).then(res=>res.json())
            .then(res=>{
                console.log('res',res)
            })
        }

        // console.log(img)
    }

</script>
</html>
<!-- curl -d'email=234' -X POST http://localhost:3001/resign/email -->